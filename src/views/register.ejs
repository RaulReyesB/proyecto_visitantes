<!DOCTYPE html>
<html>

<head>
    <title><%= namePage %></title>
    <!-- Comentarios sobre los recursos incluidos -->
    <link rel="stylesheet" href="/css/styleRegister.css">
    <link rel="stylesheet" href="/css/nav.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="icon" type="image/ico" href="/img/logohidalgo.ico">
    <style>
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[id="childrenInput"] {
            -moz-appearance: textfield;
        }
    </style>
</head>

<body style="font-family: 'Poppins', sans-serif;">
    <div class="fondo"></div>
    <%- include('templates/nav') %>
    <div class="container">
        <div class="cont-title">
            <h1><%= namePage %></h1>
        </div>
        <div class="container-form">
            <form action="/registroVisitas" method="POST">
                <div class="form-inputs">
                    <div class="form-p">
                        <label for="">Ingresa tu nombre completo</label>
                        <input class="form-control" type="text" name="name" id="" placeholder="Nombre Completo" required>
                        <label for="">Teléfono con 10 caracteres</label>
                        <input class="form-control" type="text" name="phone" placeholder="Teléfono" required>
                        <label for="">Correo electrónico</label>
                        <input class="form-control" type="email" name="email" placeholder="Correo electrónico" required>
                    </div>
                    <div class="form-p">
                        <label for="">CURP</label>
                        <input class="form-control" type="text" name="CURP" placeholder="CURP" required pattern="[A-Z0-9]{18}">
                        <label for="">Identificación</label>
                        <select class="form-control" name="identification" required>
                            <option selected disabled>-- Seleccione una opción</option>
                            <option value="INE">INE</option>
                            <option value="Pasaporte">Pasaporte</option>
                            <option value="Licencia">Licencia</option>
                        </select>
                        <label for="">Número de gafete</label>
                        <select class="form-control" name="badge" id="badgeSelect" required>
                            <% for(let i=1; i <=50; i++) { %>
                                <option value="<%= String(i).padStart(3, '0') %>">
                                    <%= String(i).padStart(3, '0' ) %>
                                </option>
                            <% } %>
                        </select>
                    </div>
                    <div class="form-p" style="margin-right: 0;">
                        <label for="">Procedencia</label>
                        <input class="form-control" type="text" name="origin" placeholder="Procedencia" required>
                        <label for="">Número de niños</label>
                        <div class="buttons-container">
                            <button type="button" class="minus-button btn mb-1" onclick="decrement()">-</button>
                            <input style="width: 56px;" class="children-input form-control mb-1" type="number"
                                name="children" id="childrenInput" placeholder="Cuántos niños" value="0" min="0">
                            <button type="button" class="plus-button btn mb-1" onclick="increment()">+</button>
                        </div>
                        <label for="">Departamento al que se dirige</label>
                        <select class="form-control mb-2" id="mainSelect" name="department" required>
                            <option selected disabled>-- Seleccione una opción --</option>
                            <option value="DG">Dirección General</option>
                            <option value="DCFP">Dirección de coordinación financiera y planeación</option>
                            <option value="DT">Dirección de televisión</option>
                            <option value="DN">Dirección de noticias</option>
                            <option value="DR">Dirección de radio</option>
                            <option value="DI">Dirección de ingeniería</option>
                            <option value="DPE">Dirección de proyectos estratégicos</option>
                            <option value="DC">Dirección de contraloría</option>
                            <option value="DPI">Dirección de promoción e intercambio</option>
                            <option value="DJ">Dirección jurídica</option>
                            <option value="IMG">Imagen</option>
                            <option value="RH">Recursos Humanos</option>
                            <option value="ER">Estaciones de radio</option>
                        </select>
                        <select id="subSelect" class="form-control p-0" name="subDepartment" required>
                            <option selected disabled>-- Seleccione una opción --</option>
                        </select>
                    </div>
                </div>
                <input class="btn button" type="submit" value="Guardar">
            </form>
        </div>
    </div>
    <footer>
        <%- include('templates/footer') %>
    </footer>
</body>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    // Obtener badges ocupados y deshabilitar opciones
    fetch('/badges/occupied')
                    .then(response => response.json())
                    .then(data => {
                        const badgeSelect = document.getElementById('badgeSelect');
                        data.forEach(badge => {
                            const option = badgeSelect.querySelector(`option[value="${badge}"]`);
                            if (option) {
                                option.disabled = true;
                            }
                        });
                    })
                    .catch(error => console.error('Error al obtener badges ocupados:', error));
                    

    const subOptions = {
        "DG": ["Director general", "Asistente de la dirección general", "Auxiliar del dpto. de la dirección general", "Recepción de entrada principal"],
        "DCFP": ["DIR. de coordinación financiera y plan.", "Subdirector de administración", "Auxiliar Dir. de coordinación financiera y plan.", "Recursos humanos", "Servicios generales", "Almacén", "Archivo", "Tecnologías de la información"],
        "DT": ["Director de televisión", "Subdirector de contenidos", "Subdirección de producción", "Encargada de DPTO de Videoteca", "Encargado de área de deportes", "Isla edición de televisión", "Cabina de video", "Master", "Jefa de planeación y posproducción", "Encargado de Staff y equipos portátiles", "Departamento de contenido", "Programación y videoteca", "Departamento de realización", "Departamento de evaluación y seguimiento", "Departamento de producción", "Departamento de eventos"],
        "DN": ["Directora de noticias", "Asistente de redacción de noticias", "Encargado de la isla de noticias", "Reportero"],
        "DR": ["Director de red estatal de radio", "Secretaria particular DIR. Radio", "Radio Producción", "Subdirector de radio", "Gerente de radio", "Sub. Coord. de noticias de radio", "Cabina de grabación", "Recepción entrada principal"],
        "DI": ["Director de ingeniería", "Subdirector de ingeniería", "Estación terrena", "Aula de medios", "Central de aparatos"],
        "DPE": ["Director de proyectos estratégicos"],
        "DC": ["Directora de contraloría"],
        "DPI": ["Director de promoción e intercambio"],
        "DJ": ["Director jurídico"],
        "IMG": ["Subdirector de imagen"],
        "ER": ["Estación de radio Jacala", "Estación de radio Tlanchinol", "Estación de radio Huejutla", "Red estatal de radio"],
        "RH": ["Recursos Humanos"]
    };

    const mainSelect = document.getElementById('mainSelect');
    const subSelect = document.getElementById('subSelect');

    mainSelect.addEventListener('change', function () {
        subSelect.innerHTML = '';
        subSelect.disabled = false;
        const options = subOptions[this.value];

        options.forEach(option => {
            const opt = document.createElement('option');
            opt.value = option;
            opt.innerHTML = option;
            subSelect.appendChild(opt);
        });
    });

    document.querySelector('input[name="CURP"]').addEventListener('input', function (e) {
        if (e.target.value.length !== 18) {
            e.target.setCustomValidity('El campo CURP debe tener exactamente 18 caracteres.');
        } else {
            e.target.setCustomValidity('');
        }
    });

    function increment() {
        const input = document.getElementById("childrenInput");
        input.value = parseInt(input.value) + 1;
    }

    function decrement() {
        const input = document.getElementById("childrenInput");
        if (parseInt(input.value) > 0) {
            input.value = parseInt(input.value) - 1;
        }
    }
</script>

</html>
